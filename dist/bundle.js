(()=>{var e,t={5872:(e,t,a)=>{"use strict";var r=a(3914);const o={};class ExtConnection{_mapIdls={};_identity=!1;_host=!1;_agent=!1;_canisters={};constructor(e,t){t&&(this._identity=t),e&&(this._host=e),this._makeAgent()}idl(e,t){return this._mapIdls[e]=t,this}setIdentity(e){return this._identity=e||!1,this._makeAgent(),this}setHost(e){return this._host=e||!1,this._makeAgent(),this}canister(e,t){if(t){if("string"==typeof t){if(!o.hasOwnProperty(t))throw new Error(t+" is not a preloaded IDL");t=o[t]}}else{if(!this._mapIdls.hasOwnProperty(e))throw new Error(t+" is not a preloaded IDL");t=this._mapIdls[e]}return this._canisters.hasOwnProperty(e)||(this._canisters[e]=r.vt.createActor(t,{agent:this._agent,canisterId:e})),this._canisters[e]}_makeAgent(){var e={};this._identity&&(e.identity=this._identity),this._host&&(e.host=this._host),this._agent=new r.i7(e)}}const n={connect:(e,t)=>new ExtConnection(e??"https://boundary.ic0.app/",t)},rotm_did=({IDL:e})=>{const t=e.Tuple(e.Opt(e.Nat),e.Opt(e.Nat),e.Opt(e.Nat),e.Opt(e.Nat),e.Opt(e.Nat),e.Opt(e.Nat)),a=e.Record({sides:t,coords:e.Tuple(e.Nat8,e.Nat8)}),r=e.Record({hexs:e.Vec(a),name:e.Text}),o=e.Nat32,n=e.Tuple(e.Nat8,e.Nat8,e.Nat8,e.Nat8,e.Nat8),s=e.Record({img:e.Text,name:e.Text,attack:n}),i=e.Nat32,l=e.Nat32,c=e.Nat32,d=e.Record({exp:e.Nat32,magni:i,upgrades:e.Vec(c),transferrable:e.Bool}),g=e.Text,u=e.Nat32,m=e.Variant({pvp:e.Tuple(o,e.Opt(g)),practice:o,opponent:u}),p=e.Nat32,h=e.Tuple(e.Nat8,e.Nat8),y=e.Variant({result:e.Tuple(h,e.Principal,e.Opt(e.Principal)),noresult:e.Tuple(e.Principal,e.Opt(e.Principal),e.Text)}),w=e.Variant({lead:e.Null,play:e.Null,ended:y,lobby:e.Null}),_=e.Record({status:w,moves:e.Vec(e.Tuple(e.Nat,e.Tuple(l,d))),option:m,lead:e.Vec(d),score:h,players:e.Vec(e.Principal),isPlayer1:e.Bool,board:r}),b=e.Variant({ok:e.Tuple(p,_),err:e.Text}),v=e.Record({hex:e.Nat,magni:l}),f=e.Variant({lead:l,move:v}),x=e.Record({magni:e.Vec(e.Tuple(i,s)),boards:e.Vec(e.Tuple(o,r))}),P=e.Record({result:e.Opt(y),moves:e.Vec(v),option:m,lead:e.Vec(l),score:h,player1:e.Opt(e.Principal),players:e.Vec(e.Principal)}),S=e.Tuple(e.Text,e.Text),O=e.Record({url:e.Text,method:e.Text,body:e.Vec(e.Nat8),headers:e.Vec(S)}),N=e.Record({body:e.Vec(e.Nat8),headers:e.Vec(S),status_code:e.Nat16});return e.Service({acceptCycles:e.Func([],[],[]),addBoard:e.Func([r],[o],[]),addMagni:e.Func([s],[i],[]),availableCycles:e.Func([],[e.Nat],["query"]),connect:e.Func([],[e.Vec(e.Tuple(l,d))],[]),eloTest:e.Func([e.Nat16,e.Nat16,e.Float64],[e.Nat16,e.Nat16],["query"]),gameCreate:e.Func([m,e.Vec(l)],[b],[]),gameFetch:e.Func([],[b],[]),gameFind:e.Func([e.Vec(l)],[b],[]),gameJoin:e.Func([g,e.Vec(l)],[b],[]),gameLeave:e.Func([p],[b],[]),gameMove:e.Func([f],[b],[]),gamePoll:e.Func([p],[b],["query"]),getAllPlayerMagni:e.Func([],[e.Vec(e.Tuple(e.Principal,e.Vec(l)))],["query"]),getGameData:e.Func([],[x],["query"]),getGameStats:e.Func([],[e.Nat,p,l],["query"]),getGames:e.Func([],[e.Vec(e.Tuple(p,P))],["query"]),getMyMagni:e.Func([],[e.Vec(e.Tuple(l,d))],["query"]),getPlayerStats:e.Func([],[e.Vec(e.Tuple(e.Principal,e.Tuple(e.Nat32,e.Nat32)))],["query"]),http_request:e.Func([O],[N],["query"]),profile:e.Func([e.Principal],[e.Opt(e.Text),e.Opt(e.Nat16),e.Opt(e.Tuple(e.Nat32,e.Nat32))],["query"]),promo:e.Func([e.Text],[e.Bool],[]),rewardReceivers:e.Func([],[e.Vec(e.Principal)],["query"]),setUsername:e.Func([e.Text],[e.Bool],[]),updateBoard:e.Func([o,r],[],[])})};var s,i,l,c,d=a(2730),g=a(3010),u=a(1766),m=a(702),p=a(5747),h=a.n(p);window.StoicIdentity=m.Z;const y=new(h())({clientId:"BHsvffJZzsm_Kb-xNOO9fGOZ2ciiMHlRjgBCeTRw18Io6OBE0QR4nd0R8AGZmL6wK9KFr9LbDeNNuj6yutSbTUA",network:"mainnet",uxMode:"popup"});function unloadROTM(){return w._gameId?w.gameLeave():null}showLoader(),function preload(e){for(var t=0;t<e.length;t++)(new Image).src=e[t]}(["./assets/bg.jpg","./assets/bgs/arena.jpg","./assets/bgs/lobby.jpg","./assets/bgs/menu.jpg","./assets/heros/h0.png","./assets/heros/h1.png","./assets/heros/h2.png","./assets/heros/h3.png","./assets/heros/h4.png","./assets/heros/h5.png","./assets/heros/h6.png","./assets/heros/h7.png","./assets/heros/h8.png","./assets/heros/h9.png","./assets/heros/h10.png","./assets/heros/h11.png","./assets/heros/h12.png","./assets/heros/h13.png","./assets/heros/h14.png","./assets/heros/h15.png","./assets/heros/h16.png","./assets/heros/h17.png","./assets/heros/h18.png","./assets/heros/h19.png","./assets/heros/ring0.png","./assets/heros/ring1.png","./assets/heros/ring2.png","./assets/heros/ring3.png"]),document.addEventListener("DOMContentLoaded",(async()=>{API=n.connect().idl("p5mob-qaaaa-aaaah-qaebq-cai",rotm_did).canister("p5mob-qaaaa-aaaah-qaebq-cai"),s=await g.L.create(),await y.init();for(var e=await API.getGameData(),t=0;t<e.magni.length;t++)CONFIG.magni.push([e.magni[t][1].name].concat(e.magni[t][1].attack));for(t=0;t<e.boards.length;t++){CONFIG.boards[e.boards[t][1].name.toLowerCase()]=e.boards[t][1].hexs.map((e=>e.coords))}document.addEventListener("click",(({offsetX:e,offsetY:t})=>{void 0!==currentRoom.click&&currentRoom.click(e,t)})),hideLoader(),_.login.enter()})),window.addEventListener("beforeunload",(function(e){unloadROTM()}),!1),window.onbeforeunload=unloadROTM,window.addEventListener("blur",(()=>{currentSound&&!bgmuted&&currentSound.mute(!0)})),window.addEventListener("focus",(()=>{currentSound&&!bgmuted&&currentSound.mute(!1)}));const updateGameState=async e=>{if(w._intv){if("find"==state&&e.status.hasOwnProperty("lead")&&(_.game.enter(),SOUND.alert.play(),w._stopPolling(),state="busy"),"busy"==state&&(e.status.hasOwnProperty("lead")&&1==gameState&&(0!=e.lead.length&&e.isPlayer1||(gameState=0,drawMessage("It was a tie - Choose another Strike Unit!"),SOUND.alert.play(),selectedHex.unhighlight(),selectedHex=!1,w._stopPolling())),e.status.hasOwnProperty("play")&&(1==gameState&&(gameState=2,selectedHex.clear(),selectedHex=!1,e.isPlayer1?(currentPlayer=1,otherPlayer=2):(otherPlayer=1,currentPlayer=2)),e.isPlayer1&&e.moves.length%2==0?(isPlayersTurn=!0,w._stopPolling(),SOUND.alert.play(),drawMessage("It is your turn now - Deploy a Magni!")):e.isPlayer1||e.moves.length%2!=1?isPlayersTurn=!1:(isPlayersTurn=!0,w._stopPolling(),SOUND.alert.play(),drawMessage("It is your turn now - Deploy a Magni!"))),e.status.hasOwnProperty("ended")&&(w._stopPolling(),showLoader(),await loadProfile(),w.updateMagni().then((t=>{hideLoader(),t&&x0p("Congratulations!","You have unlocked a new Magni!"),gameState=3,e.status.ended.hasOwnProperty("noresult")?(drawMessage("Game over - "+e.status.ended.noresult[2]+"!"),_.game.backButton.show(),SOUND.win.play()):e.status.ended.hasOwnProperty("result")&&(drawMessage("Game over - you "+scoreMsg()+"!"),"won"==scoreMsg()?SOUND.win.play():SOUND.lose.play(),_.game.backButton.show()),bgmusic()})))),e.moves.length>movesMade){for(var t=movesMade;t<e.moves.length;t++){var a=t%2==0?1:2;gamegrid[e.moves[t][0]].isPlayerHex=a==currentPlayer,gamegrid[e.moves[t][0]].place(a,e.moves[t][1],a==currentPlayer?CONFIG.colors.ally:CONFIG.colors.enemy),t>=2&&placeHex(gamegrid[e.moves[t][0]])}movesMade=e.moves.length}currentRoom==_.game&&drawScore()}},fromHexString=e=>{"0x"===e.substr(0,2)&&(e=e.substr(2));for(var t=[],a=0;a<e.length;a+=2)t.push(parseInt(e.substr(a,2),16));return t},w={_gameState:!1,_gameId:!1,_intv:!1,_clearPolling:()=>{isPlayersTurn=!1,w._intv&&clearInterval(w._intv),w._intv=!1},_stopPolling:()=>{w._intv&&clearInterval(w._intv),w._intv=!1},_startPolling:()=>{w._intv=setInterval((()=>{API.gamePoll(w._gameId).then((e=>{e.hasOwnProperty("ok")?(w._gameState=e.ok[1],updateGameState(w._gameState)):console.log(e.err)}))}),1e3)},inGame:()=>!!w._gameState&&!w._gameState.status.hasOwnProperty("#ended"),gameFind:(e,t)=>new Promise((async(t,a)=>{w.inGame()&&a("in game");var r=e.map((e=>e[0]));API.gameFind(r).then((e=>{e.hasOwnProperty("ok")?(w._gameId=e.ok[0],w._gameState=e.ok[1],w._startPolling(),updateGameState(w._gameState),t(w._gameState)):a(e.err)})).catch(a)})),gameJoin:(e,t,a)=>new Promise((async(a,r)=>{w.inGame()&&r("in game");var o=e.map((e=>e[0]));API.gameJoin(t,o).then((e=>{e.hasOwnProperty("ok")?(w._gameId=e.ok[0],w._gameState=e.ok[1],w._startPolling(),updateGameState(w._gameState),a(w._gameState)):r(e.err)})).catch(r)})),gameCreate:(e,t,a)=>new Promise((async(a,r)=>{w.inGame()&&r("in game");var o=e.map((e=>e[0]));API.gameCreate({pvp:[0,[t]]},o).then((e=>{e.hasOwnProperty("ok")?(w._gameId=e.ok[0],w._gameState=e.ok[1],w._startPolling(),updateGameState(w._gameState),a(w._gameState)):r(e.err)})).catch(r)})),gamePractise:(e,t)=>new Promise((async(t,a)=>{w.inGame()&&a("in game");var r=e.map((e=>e[0]));API.gameCreate({practice:0},r).then((e=>{e.hasOwnProperty("ok")?(w._gameId=e.ok[0],w._gameState=e.ok[1],w._startPolling(),updateGameState(w._gameState),t(w._gameState)):a(e.err)})).catch(a)})),gameMove:async(e,t)=>new Promise((async(a,r)=>{t?API.gameMove({move:{hex:t,magni:e[0]}}).then((e=>{e.hasOwnProperty("ok")?(w._gameState=e.ok[1],movesMade++,w._startPolling(),updateGameState(w._gameState),a(w._gameState)):r(e.err)})).catch(r):API.gameMove({lead:e[0]}).then((e=>{e.hasOwnProperty("ok")?(w._gameState=e.ok[1],w._startPolling(),updateGameState(w._gameState),a(w._gameState)):r(e.err)})).catch(r)})),gameEnd:()=>{w._clearPolling(),w._gameId=!1,w._gameState=!1},gameLeave:async()=>{w._clearPolling(),w._gameId&&await API.gameLeave(w._gameId),w._gameId=!1,w._gameState=!1},connect:async()=>{mymagni=await API.connect()},profile:e=>API.profile(e),getPromo:e=>API.promo(e.toUpperCase()),setUsername:e=>API.setUsername(e),updateMagni:async()=>{for(var e=!1,t=await API.connect(),a=0;a<t.length;a++){mymagni.find((e=>e[0]==t[a][0]))||(mymagni.push(t[a]),e=!0)}return e},stats:async()=>{},gs:()=>w._gameState},checkUsername=e=>/^([a-z0-9]|[-._](?![-._])){4,20}$/.test(e.toLowerCase()),drawHelp=()=>{createButton(1045,845,150,40,"Help",(()=>{window.open("https://toniqlabs.gitbook.io/rise-of-the-magni/","_blank").focus()}))},loadUser=async()=>(API=n.connect("https://boundary.ic0.app/",identity).idl("p5mob-qaaaa-aaaah-qaebq-cai",rotm_did).canister("p5mob-qaaaa-aaaah-qaebq-cai"),await w.connect(),await loadProfile(),!0),loadProfile=async()=>{var e=await w.profile(identity.getPrincipal());return l={isSet:!!e[0].length,username:e[0].length?e[0][0]:identity.getPrincipal().toText().substr(0,29)+"...",elo:(e[1].length?e[1][0]:1200).toString(),won:(e[2].length?e[2][0][0]:0).toString(),played:(e[2].length?e[2][0][1]:0).toString()},!0};var _={login:{draw:INNERDRAW.group(),enter:async()=>{var e;if(currentRoom&&currentRoom.exit(),currentRoom=_.login,currentRoom.draw.clear(),showLoader(),"2vxsx-fae"!=(e=await s.getIdentity()).getPrincipal().toString())return i="ii",identity=e,await loadUser(),setTimeout((()=>{_.menu.enter(),bgmusic("lobby")}),200),void hideLoader();if(y.privKey)return i="openlogin",identity=d.RM.generate(new Uint8Array(fromHexString(y.privKey))),await loadUser(),setTimeout((()=>{_.menu.enter(),bgmusic("lobby")}),200),void hideLoader();if(!1!==(e=await m.Z.load()))try{return i="stoic",identity=e,await loadUser(),setTimeout((()=>{_.menu.enter(),bgmusic("lobby")}),200),void hideLoader()}catch(e){console.log(e),m.Z.disconnect()}hideLoader(),setBackground("assets/bgs/menu.jpg"),createButton(500,500,200,40,"Internet Identity",(async()=>{identity||(showLoader(),s.login({maxTimeToLive:BigInt(864e11),identityProvider:"https://identity.ic0.app/",onSuccess:async()=>{i="ii",identity=await s.getIdentity(),await loadUser(),hideLoader(),_.menu.enter(),bgmusic("lobby")},onError:()=>{hideLoader(),x0p("Error!","Error logging in...")}}))})),createButton(500,560,200,40,"Open Login",(async()=>{identity||(showLoader(),await y.login(),y.privKey?(i="openlogin",identity=d.RM.generate(new Uint8Array(fromHexString(y.privKey))),await loadUser(),hideLoader(),_.menu.enter(),bgmusic("lobby")):(hideLoader(),x0p("Error!","Error logging in...")))})),createButton(500,620,200,40,"Stoic Connect",(()=>{identity||(showLoader(),m.Z.connect().then((async e=>{i="stoic",identity=e,await loadUser(),hideLoader(),_.menu.enter(),bgmusic("lobby")})).catch((e=>{m.Z.disconnect(),console.log(e),hideLoader(),x0p("Error!","Error logging in...")})))})),createButton(500,680,200,40,"Help",(()=>{window.open("https://toniqlabs.gitbook.io/rise-of-the-magni/","_blank").focus()}))},exit:()=>{currentRoom.draw.clear()}},menu:{draw:INNERDRAW.group(),enter:async()=>{if(currentRoom&&currentRoom.exit(),currentRoom=_.menu,currentRoom.draw.clear(),setBackground("assets/bgs/menu.jpg"),0==l.isSet)for(;;){var e=await x0p({title:"Please register a username",inputType:"text",inputPlaceholder:"Alphanumeric, max 20 chars.",animationType:"fadeIn",buttons:[{type:"info",text:"Register",showLoading:!0}]});if(""!==e.text)if(checkUsername(e.text)){if(await w.setUsername(e.text)){await x0p("Success!","Username has been registered!"),l.username=e.text,l.isSet=!0;break}await x0p("Error!","That username is alrady taken");continue}await x0p("Error!","Please enter a valid username")}var t,a,r,o;currentRoom.draw.rect(1200,30).move(0,0).fill("#333"),currentRoom.draw.text("Logged in as "+l.username).font({size:10,anchor:"left",family:"Verdana",weight:"bold"}).translate(5,5).fill("white"),createButton(500,500,200,40,"Adventure",(()=>{x0p("Sorry!","Sorry, not available yet...!")})),createButton(500,560,200,40,"Training",(()=>{setTimeout((()=>_.lobby.enter(1)),100)})),createButton(500,620,200,40,"Online",(()=>{setTimeout((()=>_.lobby.enter(2)),100)})),createButton(500,680,200,40,"Promo Code",(()=>{setTimeout((async()=>{var e=await x0p({title:"Enter Promo code!",inputType:"text",inputPlaceholder:"Promo Code",animationType:"fadeIn",buttons:[{type:"cancel",text:"Back"},{type:"info",text:"Enter Promo",showLoading:!0}]});""!==e.text&&(await w.getPromo(e.text)?(await w.updateMagni(),await x0p("Success!","You have unlocked a new reward!")):await x0p("Error!","Invalid promo!"))}),100)})),createButton(500,740,200,40,"Logout",(()=>{setTimeout((async()=>{"ii"==i?await s.logout():"stoic"==i?m.Z.disconnect():"openlogin"==i&&await y.logout(),identity=!1,API=n.connect().idl("p5mob-qaaaa-aaaah-qaebq-cai",rotm_did).canister("p5mob-qaaaa-aaaah-qaebq-cai"),_.login.enter()}),100)})),t=createButton(5,800,150,40,"Mute SFX",(()=>{SOUND.alert.mute(!0),SOUND.select.mute(!0),SOUND.place.mute(!0),SOUND.lose.mute(!0),SOUND.win.mute(!0),t.hide(),a.show(),sfxmuted=!0})),a=createButton(5,800,150,40,"Unmute SFX",(()=>{SOUND.alert.mute(!1),SOUND.select.mute(!1),SOUND.place.mute(!1),SOUND.lose.mute(!1),SOUND.win.mute(!1),a.hide(),t.show(),sfxmuted=!1})),sfxmuted?t.hide():a.hide(),r=createButton(5,845,150,40,"Mute BG Music",(()=>{bgmuted=!0,currentSound.mute(!0),r.hide(),o.show()})),o=createButton(5,845,150,40,"Unmute BG Music",(()=>{bgmuted=!1,currentSound.mute(!1),r.show(),o.hide()})),bgmuted?r.hide():o.hide(),drawHelp()},exit:()=>{currentRoom.draw.clear()}},settings:{draw:INNERDRAW.group(),enter:async()=>{currentRoom&&currentRoom.exit(),currentRoom=_.settings,currentRoom.draw.clear(),setBackground("assets/bgs/menu.jpg");currentRoom.draw.text("Username: "+l.username).font({size:10,anchor:"middle",family:"Verdana",weight:"bold"}).translate(600,600).fill("white"),createButton(500,740,200,40,"Back",(()=>{setTimeout((()=>_.menu.enter()),100)}))},exit:()=>{currentRoom.draw.clear()}},adventure:{draw:INNERDRAW.group(),chapter:!1,stage:!1,scene:!1,clickHandler:!1,inAdventureMode:!1,enter:(e,t)=>{currentRoom&&currentRoom.exit(),currentRoom=_.adventure,_.adventure.inAdventureMode?currentRoom.draw.show():(_.adventure.inAdventureMode=!0,currentRoom.draw.clear(),_.adventure.scene=currentRoom.draw.group(),_.adventure.chapter=0,_.adventure.stage=0,launchAdventure(e,t))},exit:()=>{_.adventure.inAdventureMode?currentRoom.draw.hide():currentRoom.draw.clear()},click:(e,t)=>{_.adventure.clickHandler&&_.adventure.clickHandler()}},lobby:{headerMessage:!1,draw:INNERDRAW.group(),hexClickHandler:(e,t,a)=>{if("free"==state&&currentRoom==_.lobby&&buttonIsFree){buttonIsFree=!1;a.x,a.y;if("hero"==a.type){if(!1!==a.magni)for(var r=0;r<playergrid.length;r++)if(0==playergrid[r].magni){playergrid[r].isPlayerHex=!0,playergrid[r].set(a.magni,CONFIG.colors.hexBg),a.removeCard(),SOUND.select.play(),updateSelectedTeam();break}}else if("team"==a.type){if(!1!==a.magni){for(r=0;r<herogrid.length;r++)if(0==herogrid[r].magni){herogrid[r].set(a.magni,CONFIG.colors.hexBg);break}a.removeCard(),SOUND.select.play(),updateSelectedTeam()}}else if("special"==a.type){var o=[];SOUND.select.play();for(r=0;r<playergrid.length;r++)!1!==playergrid[r].magni&&(o.push(playergrid[r].magni),playergrid[r].removeCard());if(o.length>0)for(r=0;r<herogrid.length&&(0!=herogrid[r].magni||(herogrid[r].set(o.pop(),CONFIG.colors.hexBg),0!=o.length));r++);for(r=0;r<herogrid.length&&!(CONFIG.starters[a.magni][1].indexOf(herogrid[r].magni[1].magni)>=0&&(o.push(herogrid[r].magni),herogrid[r].removeCard(),10==o.length));r++);for(r=0;r<o.length;r++)playergrid[r].isPlayerHex=!0,playergrid[r].set(o[r],CONFIG.colors.hexBg);updateSelectedTeam()}drawCurrentRating(),buttonIsFree=!0}},gameMode:0,enter:e=>{var t,a,r,o,n;currentRoom&&currentRoom.exit(),currentRoom=_.lobby,currentRoom.draw.clear(),state="busy",void 0!==e&&!1!==e&&(_.lobby.gameMode=e),setBackground("assets/bgs/lobby.jpg"),drawMessage("Select your team!"),0==_.lobby.gameMode?createButton(1020,10,150,40,"Start Adventure",(function(){isValidTeam()?_.adventure.enter(0,0):x0p("Whoops!","Please select a full team with a rating of 23 or less")})):1==_.lobby.gameMode?createButton(1020,10,150,40,"Start Training",(function(){if(isValidTeam()){if("free"!=state)return;showLoader(),w.gamePractise(selectedTeam,updateGameState).then((()=>{_.game.enter(),SOUND.alert.play(),w._stopPolling(),state="busy"})).catch((e=>{state="free",alert(e)})).finally((()=>{hideLoader()}))}else x0p("Whoops!","Please select a full team with a rating of 23 or less")})):2==_.lobby.gameMode&&(t=createButton(850,10,150,40,"Create Game",(()=>{if(isValidTeam()){if("free"!=state)return;showLoader();var e=makeid(5);w.gameCreate(selectedTeam,e,updateGameState).then((()=>{state="find",drawMessage("Waiting - Room code: "+e),r.hide(),t.hide(),a.hide(),o.hide(),n.show()})).catch((e=>{state="free",x0p("Whoops!",e)})).finally((()=>{hideLoader()}))}else x0p("Whoops!","Please select a full team with a rating of 23 or less")})),a=createButton(850,60,150,40,"Join Game",(async()=>{if(isValidTeam()){if("free"!=state)return;var e=await x0p("Please enter room code",null,"input"),a="info"==e.button&&e.text;a&&5==a.length?(showLoader(),w.gameJoin(selectedTeam,a.toString(),updateGameState).then((()=>{state="find",drawMessage("Joining game..."),r.hide(),t.hide(),o.hide(),n.show()})).catch((e=>{x0p("Whoops!",e),state="free"})).finally((()=>{hideLoader()}))):x0p("Whoops!","Please ener a valid room code")}else x0p("Whoops!","Please select a full team with a rating of 23 or less")})),r=createButton(1020,10,150,40,"Matchmaking",(()=>{if(isValidTeam()){if("free"!=state)return;showLoader(),w.gameFind(selectedTeam,updateGameState).then((()=>{state="find",drawMessage("Finding a match..."),r.hide(),t.hide(),a.hide(),o.hide(),n.show()})).catch((e=>{state="free",x0p("Whoops!",e)})).finally((()=>{hideLoader()}))}else x0p("Whoops!","Please select a full team with a rating of 23 or less")})),(n=createButton(1020,60,150,40,"Cancel",(()=>{showLoader(),w.gameLeave().then((()=>{state="free",drawMessage("Select your team!"),n.hide(),r.show(),t.show(),a.show(),o.show()})).catch((e=>{x0p("Whoops!",e)})).finally((()=>{hideLoader()}))}))).hide()),o=createButton(1020,60,150,40,"Back",(function(){_.menu.enter()})),currentRoom.draw.image("assets/bgs/battle.png").translate(0,752),drawPlayerProfile(l),drawHelp(),selectedHex=!1,herogrid.map(((e,t)=>{e.init("hero",currentRoom.draw.group()),t<mymagni.length&&selectedTeam.indexOf(mymagni[t])<0&&e.set(mymagni[t],CONFIG.colors.hexBg)})),playergrid.map(((e,t)=>{e.isPlayerHex=!0,e.init("team",currentRoom.draw.group()),selectedTeam.length>t&&selectedTeam[t]&&e.set(selectedTeam[t],CONFIG.colors.hexBg)})),premadegrid.map(((e,t)=>{e.init("special",currentRoom.draw.group()),e.special(CONFIG.starters[t][0],t)})),drawCurrentRating(),state="free"},click:(e,t)=>{},exit:()=>{currentRoom.draw.clear(),currentRoom.headerMessage=!1,omd=!1,rd=!1}},game:{headerMessage:!1,draw:INNERDRAW.group(),hexClickHandler:(e,t,a)=>{if(3!=gameState){a.x,a.y;0==gameState?"team"==a.type&&(selectedHex=a,selectedHex.highlight(CONFIG.colors.ally),gameState=1,drawMessage("Waiting for other player..."),w.gameMove(selectedHex.magni),SOUND.select.play()):2==gameState&&isPlayersTurn&&("game"==a.type&&0==a.player&&selectedHex&&(w.gameMove(selectedHex.magni,a.index),a.isPlayerHex=!0,isPlayersTurn=!1,a.place(currentPlayer,selectedHex.magni,CONFIG.colors.ally),SOUND.place.play(),placeHex(a,!0),selectedHex.clear(),drawMessage("Waiting for other player...")),"team"==a.type&&!1!==a.magni&&(selectedHex&&selectedHex.unhighlight(),a.highlight(CONFIG.colors.ally),selectedHex=a,SOUND.select.play()))}},character:!1,board:!1,result:0,playerScore:0,opponentScore:0,enter:async(e,t,a,r)=>{currentRoom&&currentRoom.exit(),currentRoom=_.game,currentRoom.draw.clear(),localScore=[0,0],bgmusic("battle"),setBackground("assets/bgs/arena.jpg"),currentRoom.draw.image("assets/bgs/battle.png").translate(0,752),selectedHex=!1,gameState=0,movesMade=0,r&&(_.game.character=r),e||(e="Back"),t||(t=e=>{bgmusic("lobby"),w.gameEnd(),_.lobby.enter()}),a||(a=CONFIG.boards.standard),gamegrid=Grid(a),_.game.board=a,_.game.backButton=createButton(1020,10,150,40,e,(()=>{t(_.game.result)})),_.game.backButton.hide(),gamegrid.map(((e,t)=>{e.index=t,e.magni=!1,e.player=0,e.init("game",currentRoom.draw.group())}));var o=0;playergrid.map((e=>{e.isPlayerHex=!0,e.init("team",currentRoom.draw.group()),e.set(selectedTeam[o++],CONFIG.colors.hexBg)})),await(async()=>{var e=w.gs();console.log(e),console.log(e.players),console.log(e.players[0]),console.log(e.players[0].toText());var t=identity.getPrincipal().toText()==e.players[0].toText()?e.players[1]:e.players[0];if("2vxsx-fae"==t.toText())c={username:"THE BEAST",elo:"Over 9000!",won:"0",played:"TOO MANY"};else{var a=await w.profile(t);c={username:a[0].length?a[0][0]:identity.getPrincipal().toText().substr(0,29)+"...",elo:(a[1].length?a[1][0]:1200).toString(),won:(a[2].length?a[2][0][0]:0).toString(),played:(a[2].length?a[2][0][1]:0).toString()}}return!0})(),drawPlayerProfile(l),drawOpponentProfile(c),drawMessage("Game found - Select your Strike Unit")},exit:()=>{currentRoom.draw.clear(),currentRoom.headerMessage=!1,st1=!1,st2=!1,omd=!1}}};window.rooms=_,window.ROTM=w,window.SOUND={alert:new u.Howl({src:["assets/sounds/alert.mp3"]}),battle:new u.Howl({src:["assets/sounds/battle.wav"]}),lobby:new u.Howl({src:["assets/sounds/lobby.wav"]}),lose:new u.Howl({src:["assets/sounds/lose.wav"]}),place:new u.Howl({src:["assets/sounds/place.wav"]}),select:new u.Howl({src:["assets/sounds/select.mp3"]}),win:new u.Howl({src:["assets/sounds/win.mp3"]})},SOUND.battle.volume(.5),SOUND.alert.volume(.2),SOUND.select.volume(.4),SOUND.place.volume(.1),SOUND.lose.volume(.1),SOUND.win.volume(.1)},6641:()=>{},6601:()=>{},9214:()=>{},1156:()=>{},2361:()=>{},4616:()=>{},5024:()=>{}},a={};function __webpack_require__(e){var r=a[e];if(void 0!==r)return r.exports;var o=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,__webpack_require__),o.loaded=!0,o.exports}__webpack_require__.m=t,__webpack_require__.amdO={},e=[],__webpack_require__.O=(t,a,r,o)=>{if(!a){var n=1/0;for(c=0;c<e.length;c++){for(var[a,r,o]=e[c],s=!0,i=0;i<a.length;i++)(!1&o||n>=o)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](a[i])))?a.splice(i--,1):(s=!1,o<n&&(n=o));if(s){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[a,r,o]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={296:0};__webpack_require__.O.j=t=>0===e[t];var webpackJsonpCallback=(t,a)=>{var r,o,[n,s,i]=a,l=0;for(r in s)__webpack_require__.o(s,r)&&(__webpack_require__.m[r]=s[r]);if(i)var c=i(__webpack_require__);for(t&&t(a);l<n.length;l++)o=n[l],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[n[l]]=0;return __webpack_require__.O(c)},t=self.webpackChunkrotm_v2=self.webpackChunkrotm_v2||[];t.forEach(webpackJsonpCallback.bind(null,0)),t.push=webpackJsonpCallback.bind(null,t.push.bind(t))})();var r=__webpack_require__.O(void 0,[646],(()=>__webpack_require__(5872)));r=__webpack_require__.O(r)})();
//# sourceMappingURL=bundle.js.map